------

# Docker

> 作者：hou
------
## 1.1 对比Docker和虚拟机的区别

虚拟机虚拟的是硬件，容器虚拟的是操作系统层应用运行环境
虚拟机就像每个租客都拥有一整套公寓，即使只是住一个人，也得建完整的房子。
Docker 就像合租公寓，只要租一个房间，就可以了，不需要建完整的房子。

## 1.2 镜像

- 只读模板，不可修改
- 通过Dockerfile构建生成
- 采用分层存储结构，每条 Dockerfile 中的指令（如 FROM、COPY、RUN）都会创建一层 Layer
    - 最终的镜像是这些只读层的堆叠，加上一个可写层（Writable Layer
    - 优点：
        - 缓存加速构建：比如只改了最后一行，那会从倒数第2层开始重新构建，其它用缓存。
        - 共享层节省磁盘空间：有多个基于同一个 ubuntu 系统的镜像，底层 ubuntu 系统只需在硬盘上保存一份
        - 分发优化：当你推送镜像到远程仓库（或拉取镜像）时，如果远端仓库已经有某些层（比如公共 ubuntu 底层镜像），Docker 只需要上传或下载新增变化的层。

### 1.2.1 多阶段构建

将“构建依赖”和“运行依赖”分离，生成 小体积、安全、干净 的镜像。
    - 第一阶段包含编译器、源代码、构建缓存等，但不会进入最终镜像。
    - 最终镜像只有运行所需的二进制文件，更小、更安全、更快

## 1.3 容器

- 镜像的运行实例
- 包含可写的容器层
- 生命周期包括创建/启动/停止/删除